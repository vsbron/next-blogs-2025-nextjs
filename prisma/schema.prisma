
datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

// MODELS
model User {
  clerkId         String        @id
  email           String        @unique
  username        String        @unique
  imageUrl        String?
  dateCreated     DateTime      @default(now())
  
  displayName     String
  birthday        String?
  gender          String        @default("Unknown")
  country         String?
  bio             String?
  
  website         String?
  facebook        String?
  x               String?
  instagram       String?
  reddit          String?

  posts           Post[]
  likes           Like[]
  comments        Comment[]
}

model Post {
  id              Int           @id @default(autoincrement())
  title           String
  preview         String
  text            String
  imageUrl        String
  category        String
  published       DateTime      @default(now())
  updated         DateTime      @default(now())
  authorId        String
  author          User          @relation(fields: [authorId], references: [clerkId])
  likes           Like[]
  likesCount      Int           @default(0)
  comments        Comment[]
  commentsCount   Int           @default(0)
  views           Int           @default(0)
  
  @@index([published])
  @@index([category])
  @@index([authorId])
} 

model Like {
  id              Int           @id @default(autoincrement())
  user            User          @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  userId          String
  post            Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId          Int
  likedTime       DateTime      @default(now())

  @@unique([userId,postId])
  @@index([postId])
  @@index([userId])
}

model Comment {
  id              Int           @id @default(autoincrement())
  user            User          @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  userId          String
  post            Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId          Int
  commentText     String
  commentedTime   DateTime      @default(now())

  @@index([postId])
  @@index([userId])
  @@index([postId, commentedTime])
}